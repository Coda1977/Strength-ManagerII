<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Strengths Coach - Strengths Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #F5F0E8;
            --text-primary: #1A1A1A;
            --accent-yellow: #FFD60A;
            --accent-blue: #003566;
            --text-secondary: #4A4A4A;
            --white: #FFFFFF;
            --border-light: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Navigation */
        .app-nav {
            background: var(--white);
            border-bottom: 1px solid var(--border-light);
            z-index: 100;
            flex-shrink: 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -1px;
            color: var(--text-primary);
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-item {
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-item:hover {
            color: var(--text-primary);
            background: var(--bg-primary);
        }

        .nav-item.active {
            color: var(--text-primary);
            background: var(--accent-yellow);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
        }

        /* Main Layout */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Sidebar Toggle Button - REMOVED */
        /* Replaced with edge swipe handle */

        /* Edge Swipe Handle */
        .edge-swipe-handle {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 80px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 4px 4px 0;
            z-index: 200;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .edge-swipe-handle:hover {
            width: 12px;
            background: rgba(0, 0, 0, 0.3);
        }

        /* Touch indicator on mobile */
        @media (hover: none) {
            .edge-swipe-handle {
                width: 20px;
                background: transparent;
                touch-action: pan-y;
            }
            
            .edge-swipe-handle::before {
                content: '';
                position: absolute;
                right: 0;
                top: 0;
                bottom: 0;
                width: 4px;
                background: rgba(0, 0, 0, 0.15);
                border-radius: 0 4px 4px 0;
            }
        }

        /* Hide handle when sidebar is open */
        .main-container:not(.sidebar-hidden) .edge-swipe-handle {
            opacity: 0;
            pointer-events: none;
        }

        /* Swipe overlay for closing sidebar */
        .swipe-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 45;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .main-container:not(.sidebar-hidden) .swipe-overlay {
            opacity: 1;
            pointer-events: all;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--white);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease, transform 0.3s ease;
            position: relative;
            z-index: 50;
            flex-shrink: 0;
        }

        .sidebar.hidden {
            margin-left: -320px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--bg-primary);
            padding: 4px;
            border-radius: 28px;
        }

        .mode-button {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .mode-button.active {
            background: var(--white);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            color: var(--text-primary);
        }

        .new-chat-button {
            width: 100%;
            padding: 14px;
            background: var(--text-primary);
            color: var(--white);
            border: none;
            border-radius: 28px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .empty-history {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-history h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-history p {
            font-size: 14px;
            line-height: 1.5;
        }

        .history-section {
            margin-bottom: 24px;
            display: none;
        }

        .history-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 0 12px;
        }

        .history-item {
            padding: 14px 16px;
            margin-bottom: 4px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            padding-right: 40px;
        }

        .history-item:hover {
            background: var(--bg-primary);
        }

        .history-item.active {
            background: var(--bg-primary);
            font-weight: 600;
        }

        .history-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-yellow);
            opacity: 0.7;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .history-item.active .history-icon {
            opacity: 1;
        }

        .history-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-chat {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }

        .history-item:hover .delete-chat {
            opacity: 1;
        }

        .delete-chat:hover {
            background: rgba(255, 0, 0, 0.1);
            color: #dc2626;
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            min-width: 0;
            transition: all 0.3s ease;
        }

        /* When sidebar is hidden, chat takes full width */
        .main-container.sidebar-hidden .chat-container {
            margin-left: 0;
        }

        .chat-header {
            background: var(--white);
            padding: 2rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .chat-title {
            font-size: 22px;
            font-weight: 700;
        }

        .mobile-sidebar-toggle {
            display: none;
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .mobile-sidebar-toggle:hover {
            background: var(--bg-primary);
        }

        /* Messages Container */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        .welcome-message {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: var(--text-secondary);
        }

        .welcome-content {
            max-width: 500px;
        }

        .welcome-content h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .welcome-content p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .starter-questions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .starter-question {
            background: var(--white);
            border: 2px solid var(--border-light);
            padding: 16px 20px;
            border-radius: 20px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .starter-question:hover {
            border-color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Message Styling */
        .message {
            display: flex;
            gap: 12px;
            max-width: 720px;
            width: 100%;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--text-primary);
            color: var(--white);
        }

        .message.ai .message-avatar {
            background: var(--accent-yellow);
            color: var(--text-primary);
        }

        .message-content {
            background: var(--white);
            padding: 16px 20px;
            border-radius: 20px;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            font-size: 15px;
            word-wrap: break-word;
            position: relative;
        }

        .message.user .message-content {
            background: var(--text-primary);
            color: var(--white);
        }

        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 6px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .message:hover .copy-button {
            opacity: 1;
        }

        .copy-button:hover {
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
        }

        .message.user .copy-button {
            color: rgba(255, 255, 255, 0.7);
        }

        .message.user .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .insight-box {
            background: var(--bg-primary);
            padding: 14px 16px;
            border-radius: 12px;
            margin: 12px 0;
            border-left: 3px solid var(--accent-yellow);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 12px;
            max-width: 720px;
            width: 100%;
            animation: messageSlide 0.3s ease-out;
        }

        .typing-content {
            background: var(--white);
            padding: 16px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .typing-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: typingDot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typingDot {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Suggested Questions */
        .suggested-questions {
            padding: 2rem;
            background: var(--white);
            border-top: 1px solid var(--border-light);
            display: none;
        }

        .suggestions-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .question-chips {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .question-chip {
            background: var(--bg-primary);
            border: 2px solid transparent;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .question-chip:hover {
            border-color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* Input Area */
        .input-container {
            padding: 2rem;
            background: var(--white);
            border-top: 1px solid var(--border-light);
            flex-shrink: 0;
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            max-width: 720px;
            margin: 0 auto;
        }

        .message-input {
            flex: 1;
            padding: 14px 24px;
            border: 2px solid var(--border-light);
            border-radius: 28px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s ease;
            background: var(--bg-primary);
            resize: none;
            min-height: 48px;
            max-height: 120px;
            font-family: inherit;
        }

        .message-input:focus {
            border-color: var(--text-primary);
            background: var(--white);
        }

        .send-button {
            background: var(--text-primary);
            color: var(--white);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--text-primary);
            color: var(--white);
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .nav-container {
                padding: 1rem;
            }

            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--white);
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .nav-menu.active {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 150;
                width: 280px;
            }

            .edge-swipe-handle {
                width: 30px;
            }

            .mobile-overlay {
                display: none;
            }

            .chat-header {
                padding: 16px 20px;
                position: relative;
            }

            .mobile-sidebar-toggle {
                display: none;
            }

            .chat-title {
                font-size: 18px;
            }

            .messages-container {
                padding: 20px;
            }

            .message {
                max-width: 100%;
            }

            .welcome-content h2 {
                font-size: 24px;
            }

            .welcome-content p {
                font-size: 16px;
            }

            .starter-question {
                padding: 12px 16px;
                font-size: 14px;
            }

            .suggested-questions {
                padding: 12px 20px;
            }

            .input-container {
                padding: 16px 20px;
            }

            .input-wrapper {
                max-width: none;
            }

            .delete-chat {
                opacity: 0.6;
            }
        }

        @media (max-width: 480px) {
            .messages-container {
                padding: 16px;
                gap: 16px;
            }

            .message-content {
                padding: 12px 16px;
                font-size: 14px;
            }

            .input-container {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="app-nav">
        <div class="nav-container">
            <a href="#" class="logo">Strengths Manager</a>
            <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
            <div class="nav-menu" id="navMenu">
                <a href="#" class="nav-item">Dashboard</a>
                <a href="#" class="nav-item">Encyclopedia</a>
                <a href="#" class="nav-item active">AI Coach</a>
            </div>
        </div>
    </nav>

    <div class="main-container sidebar-hidden" id="mainContainer">
        <!-- Edge Swipe Handle -->
        <div class="edge-swipe-handle" id="edgeSwipeHandle"></div>
        
        <!-- Swipe Overlay -->
        <div class="swipe-overlay" id="swipeOverlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar hidden" id="sidebar">
            <div class="sidebar-header">
                <div class="mode-toggle">
                    <button class="mode-button active" id="personalMode">My Strengths</button>
                    <button class="mode-button" id="teamMode">Team</button>
                </div>
                <button class="new-chat-button" id="newChatBtn">
                    <span>+</span>
                    New Chat
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
                <div class="empty-history" id="emptyHistory">
                    <h3>No conversations yet</h3>
                    <p>Start a new chat to begin exploring your strengths with AI guidance.</p>
                </div>
                
                <div class="history-section" id="todaySection">
                    <div class="history-section-title">Today</div>
                    <div id="todayChats"></div>
                </div>
            </div>
        </aside>

        <!-- Chat Container -->
        <main class="chat-container">
            <header class="chat-header">
                <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <h1 class="chat-title" id="chatTitle">AI Strengths Coach</h1>
            </header>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message" id="welcomeMessage">
                    <div class="welcome-content">
                        <h2>Welcome to your AI Strengths Coach!</h2>
                        <p>I'm here to help you understand and leverage your CliftonStrengths for better leadership and team dynamics.</p>
                        <div class="starter-questions">
                            <button class="starter-question" data-question="How can I better leverage my top strengths as a manager?">
                                How can I better leverage my top strengths as a manager?
                            </button>
                            <button class="starter-question" data-question="What should I know about managing different strength types?">
                                What should I know about managing different strength types?
                            </button>
                            <button class="starter-question" data-question="How do I identify and develop my team's strengths?">
                                How do I identify and develop my team's strengths?
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="suggested-questions" id="suggestedQuestions">
                <div class="suggestions-title">Suggested follow-ups</div>
                <div class="question-chips" id="questionChips"></div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <textarea class="message-input" id="messageInput" placeholder="Ask about your strengths or team..." rows="1"></textarea>
                    <button class="send-button" id="sendButton">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Copy Notification -->
    <div class="copy-notification" id="copyNotification">Message copied!</div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <script>
        // Global variables
        let currentChatId = null;
        let conversations = [];
        let currentMode = 'personal';
        let sidebarVisible = true;
        let isTyping = false;

        const strengthsThemes = [
            'Achiever', 'Activator', 'Adaptability', 'Analytical', 'Arranger', 'Belief',
            'Command', 'Communication', 'Competition', 'Connectedness', 'Consistency', 'Context',
            'Deliberative', 'Developer', 'Discipline', 'Empathy', 'Focus', 'Futuristic',
            'Harmony', 'Ideation', 'Includer', 'Individualization', 'Input', 'Intellection',
            'Learner', 'Maximizer', 'Positivity', 'Relator', 'Responsibility', 'Restorative',
            'Self-Assurance', 'Significance', 'Strategic', 'Woo'
        ];

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            setupEventListeners();
            
            // Start with sidebar hidden for better mobile experience
            sidebarVisible = false;
            
            document.getElementById('messageInput').focus();
        });

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                console.log('Mobile menu toggle clicked');
                document.getElementById('navMenu').classList.toggle('active');
            });

            // Edge swipe handle click
            document.getElementById('edgeSwipeHandle').addEventListener('click', function() {
                console.log('Edge handle clicked');
                openSidebar();
            });

            // Swipe overlay click (close sidebar)
            document.getElementById('swipeOverlay').addEventListener('click', function() {
                console.log('Overlay clicked');
                closeSidebar();
            });

            // Touch gesture support for edge swipe
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, false);

            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipeGesture();
            }, false);

            function handleSwipeGesture() {
                // Swipe right from left edge to open
                if (touchStartX < 50 && touchEndX > touchStartX + 50 && sidebarVisible === false) {
                    openSidebar();
                }
                // Swipe left to close
                else if (touchEndX < touchStartX - 50 && sidebarVisible === true) {
                    closeSidebar();
                }
            }

            // Mobile sidebar toggle
            document.getElementById('mobileSidebarToggle').addEventListener('click', function() {
                console.log('Mobile sidebar toggle clicked');
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                
                sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('show');
            });

            // Mobile overlay click
            document.getElementById('mobileOverlay').addEventListener('click', function() {
                console.log('Mobile overlay clicked');
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('show');
            });

            // Mode buttons
            document.getElementById('personalMode').addEventListener('click', function() {
                console.log('Personal mode clicked');
                switchMode('personal', this);
            });

            document.getElementById('teamMode').addEventListener('click', function() {
                console.log('Team mode clicked');
                switchMode('team', this);
            });

            // New chat button
            document.getElementById('newChatBtn').addEventListener('click', function() {
                console.log('New chat button clicked');
                startNewChat();
            });

            // Send button
            document.getElementById('sendButton').addEventListener('click', function() {
                console.log('Send button clicked');
                sendMessage();
            });

            // Message input
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            });

            messageInput.addEventListener('input', function() {
                adjustTextareaHeight(this);
            });

            // Starter questions
            document.querySelectorAll('.starter-question').forEach(button => {
                button.addEventListener('click', function() {
                    console.log('Starter question clicked:', this.dataset.question);
                    askQuestion(this.dataset.question);
                });
            });

            // Navigation items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.getElementById('navMenu').classList.remove('active');
                });
            });
        }

        function openSidebar() {
            console.log('Opening sidebar');
            const sidebar = document.getElementById('sidebar');
            const mainContainer = document.getElementById('mainContainer');
            
            sidebarVisible = true;
            sidebar.classList.remove('hidden');
            mainContainer.classList.remove('sidebar-hidden');
        }

        function closeSidebar() {
            console.log('Closing sidebar');
            const sidebar = document.getElementById('sidebar');
            const mainContainer = document.getElementById('mainContainer');
            
            sidebarVisible = false;
            sidebar.classList.add('hidden');
            mainContainer.classList.add('sidebar-hidden');
        }

        function switchMode(mode, clickedButton) {
            console.log('Switching to mode:', mode);
            currentMode = mode;
            
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            clickedButton.classList.add('active');
        }

        function startNewChat() {
            console.log('Starting new chat');
            currentChatId = Date.now().toString();
            document.getElementById('chatTitle').textContent = 'New Conversation';
            
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = `
                <div class="welcome-message">
                    <div class="welcome-content">
                        <h2>What would you like to explore?</h2>
                        <p>Ask me anything about strengths-based leadership, team dynamics, or how to apply your CliftonStrengths.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('suggestedQuestions').style.display = 'none';
            document.getElementById('messageInput').focus();
            
            // Close sidebar after starting new chat
            closeSidebar();
        }

        function askQuestion(question) {
            console.log('Asking question:', question);
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            console.log('Sending message:', message);
            
            if (!message || isTyping) {
                console.log('Message empty or already typing');
                return;
            }

            // Clear welcome message
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            // Add user message
            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';

            // Show loading state
            setSendingState(true);
            showTypingIndicator();

            // Simulate AI response
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAIResponse(message);
                addMessage(response, 'ai');
                showSuggestedQuestions();
                setSendingState(false);
                
                // Update chat history if new conversation
                if (currentChatId && !conversations.find(c => c.id === currentChatId)) {
                    const title = generateChatTitle(message);
                    addChatToHistory(currentChatId, title, message);
                    document.getElementById('chatTitle').textContent = title;
                }
                
                input.focus();
            }, 2000 + Math.random() * 1000);
        }

        function setSendingState(sending) {
            const sendButton = document.getElementById('sendButton');
            isTyping = sending;
            sendButton.disabled = sending;
            
            if (sending) {
                sendButton.innerHTML = '<div class="send-spinner"></div>';
            } else {
                sendButton.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                `;
            }
        }

        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 'You' : 'AI';
            const copyButton = `
                <button class="copy-button" onclick="copyMessage(this)" title="Copy message">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                </button>
            `;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    ${content}
                    ${copyButton}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                messagesContainer.scrollTo({
                    top: messagesContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">AI</div>
                <div class="typing-content">
                    <span class="typing-text">Thinking</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            
            setTimeout(() => {
                messagesContainer.scrollTo({
                    top: messagesContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function generateAIResponse(message) {
            const responses = {
                'strengths': 'Understanding your strengths is the foundation of effective leadership. Each CliftonStrengths theme represents a natural pattern of thinking, feeling, or behaving. The key is to identify how your top themes work together and how you can apply them intentionally in your leadership role.<div class="insight-box"><strong>Key insight:</strong> Focus on developing your strengths rather than fixing your weaknesses. Research shows that people who use their strengths are 6x more engaged at work.</div>',
                'team': 'Great teams are built on complementary strengths, not similar ones. When you understand each team member\'s top themes, you can assign roles that energize them, create partnerships that multiply their impact, and avoid conflicts that stem from different working styles.<div class="insight-box"><strong>Practical tip:</strong> Create a team strengths map. Post everyone\'s top 5 themes somewhere visible and reference them when assigning projects or forming work groups.</div>',
                'management': 'Strengths-based management starts with this insight: people perform best when they get to use their natural talents. Instead of trying to fix weaknesses, focus on developing each person\'s strengths and finding ways to make their weaknesses irrelevant.<div class="insight-box"><strong>Management shift:</strong> Change your question from "How can I fix this person?" to "How can I position this person to succeed using their natural talents?"</div>',
                'leverage': 'To leverage your strengths effectively, you need to understand not just what they are, but how they show up in your daily work. Each strength has different expressions depending on your role, team, and organizational context.<div class="insight-box"><strong>Action step:</strong> For each of your top 5 strengths, identify one specific way you could apply it more intentionally in your current role this week.</div>',
                'default': 'That\'s a thoughtful question! Strengths-based leadership is about recognizing that each person has unique talents and finding ways to help them apply those talents for maximum impact. The best leaders don\'t try to be well-rounded - they focus on being exceptional at what they naturally do best.<div class="insight-box"><strong>Remember:</strong> Your greatest opportunity for growth lies not in fixing your weaknesses, but in maximizing your strengths.</div>'
            };
            
            const lowerMessage = message.toLowerCase();
            if (lowerMessage.includes('strength')) return responses.strengths;
            if (lowerMessage.includes('team')) return responses.team;
            if (lowerMessage.includes('manage') || lowerMessage.includes('leader')) return responses.management;
            if (lowerMessage.includes('leverage') || lowerMessage.includes('apply')) return responses.leverage;
            return responses.default;
        }

        function generateChatTitle(firstMessage) {
            const foundStrength = strengthsThemes.find(strength => 
                firstMessage.toLowerCase().includes(strength.toLowerCase())
            );
            
            if (foundStrength) {
                return foundStrength;
            }
            
            const words = firstMessage.split(' ').slice(0, 3);
            return words.join(' ') + (firstMessage.split(' ').length > 3 ? '...' : '');
        }

        function getChatIcon(message, mode) {
            if (mode === 'team' || message.toLowerCase().includes('team') || 
                message.toLowerCase().includes('manage') || message.toLowerCase().includes('group')) {
                return '👥';
            }
            return '👤';
        }

        function showSuggestedQuestions() {
            const suggestions = [
                "How do I identify my team's strengths?",
                "What's the difference between talents and strengths?",
                "How can I develop my weaker themes?",
                "What makes a great strengths-based team?",
                "How do I handle conflicts between different strength types?"
            ];
            
            const randomSuggestions = suggestions.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            const chips = randomSuggestions.map(suggestion => 
                `<button class="question-chip" onclick="askQuestion('${suggestion.replace(/'/g, '\\\'')}')">${suggestion}</button>`
            ).join('');
            
            document.getElementById('questionChips').innerHTML = chips;
            document.getElementById('suggestedQuestions').style.display = 'block';
        }

        function addChatToHistory(id, title, firstMessage) {
            const emptyHistory = document.getElementById('emptyHistory');
            if (emptyHistory) {
                emptyHistory.style.display = 'none';
            }
            
            const todaySection = document.getElementById('todaySection');
            todaySection.style.display = 'block';
            
            const icon = getChatIcon(firstMessage, currentMode);
            
            conversations.push({
                id: id,
                title: title,
                timestamp: new Date(),
                mode: currentMode,
                icon: icon
            });
            
            const chatItem = document.createElement('div');
            chatItem.className = 'history-item active';
            chatItem.innerHTML = `
                <div class="history-icon">${icon}</div>
                <div class="history-text">${title}</div>
                <button class="delete-chat" onclick="deleteChat(event, '${id}')" title="Delete chat">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19,6V20a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                </button>
            `;
            
            chatItem.addEventListener('click', function(e) {
                if (e.target.closest('.delete-chat')) return;
                loadChat(id, this);
            });
            
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById('todayChats').appendChild(chatItem);
        }

        function loadChat(chatId, chatElement) {
            console.log('Loading chat:', chatId);
            
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });
            
            chatElement.classList.add('active');
            
            const chatTitle = chatElement.querySelector('.history-text').textContent;
            document.getElementById('chatTitle').textContent = chatTitle;
            
            // Close sidebar after loading chat
            closeSidebar();
        }

        function deleteChat(event, chatId) {
            console.log('Deleting chat:', chatId);
            event.stopPropagation();
            
            if (confirm('Delete this conversation?')) {
                const chatItem = event.target.closest('.history-item');
                if (chatItem) {
                    chatItem.remove();
                }
                
                conversations = conversations.filter(c => c.id !== chatId);
                
                if (conversations.length === 0) {
                    const emptyHistory = document.getElementById('emptyHistory');
                    if (emptyHistory) {
                        emptyHistory.style.display = 'block';
                    }
                    document.getElementById('todaySection').style.display = 'none';
                }
            }
        }

        function copyMessage(button) {
            console.log('Copying message');
            const messageContent = button.parentElement;
            const textToCopy = messageContent.textContent.replace('Copy message', '').trim();
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                showCopyNotification();
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyNotification();
            });
        }

        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // Window resize handler
        window.addEventListener('resize', function() {
            // Handle resize if needed
        });
    </script>
</body>
</html>